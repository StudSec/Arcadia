<div class="row"
    style="min-height: 50vh; display: flex; flex-direction: column; justify-content: center; align-items: center; text-align: center;">
    <div class="container text-center">
        <img src="https://github.com/StudSec/Arcadia/blob/hackherquest/config/ctfd-setup/images/logo.png?raw=true"
            alt="CTF Logo" style="max-height: max(150px, 15vw); margin-bottom: 30px; margin-top: 20vh; width: auto;">

        <h1 id="status-title" style="margin-bottom: 20px;">Loading...</h1>
        <div id="timer-display" style="font-size: 3em; font-family: monospace; font-weight: bold;">
            --:--:--
        </div>
    </div>
</div>

<script>
    document.addEventListener("DOMContentLoaded", function () {
        var start = "{{ ctf_start }}";
        var end = "{{ ctf_end }}";

        var titleElem = document.getElementById("status-title");
        var timerElem = document.getElementById("timer-display");

        if (start === "" || end === "") {
            titleElem.innerText = "Welcome to the HackHerQuest CTF";
            timerElem.style.display = "none";
            return;
        }

        var start = new Date(start).getTime();
        var end = new Date(end).getTime();

        var x = setInterval(function () {
            // Get today's date and time
            var now = new Date().getTime();

            // Find the distance between now and the count down date
            var timeTillStart = start - now;
            var timeTillEnd = end - now;

            if (timeTillEnd < 0) {
                titleElem.innerText = "The CTF is over!";
                timerElem.style.fontSize = "1.5em"; // Make text smaller since it's a sentence
                timerElem.innerText = "However, the results & challenges are still available";
                // Stop the loop since we don't need to count down anymore
                clearInterval(x);
            } else if (timeTillStart < 0 && timeTillEnd >= 0) {
                titleElem.innerText = "Time Remaining:";
                timerElem.innerText = formatTime(timeTillEnd);
            } else {
                titleElem.innerText = "The CTF Starts In:";
                timerElem.innerText = formatTime(timeTillStart);
            }
        }, 1000);

        // Helper to format milliseconds into D:H:M:S
        function formatTime(distance) {
            if (distance < 0) return "00:00:00";
            // Time calculations for days, hours, minutes and seconds
            var days = Math.floor(distance / (1000 * 60 * 60 * 24));
            var hours = Math.floor(
                (distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60)
            );
            var minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
            var seconds = Math.floor((distance % (1000 * 60)) / 1000);

            // Pad with leading zeros
            hours = hours < 10 ? "0" + hours : hours;
            minutes = minutes < 10 ? "0" + minutes : minutes;
            seconds = seconds < 10 ? "0" + seconds : seconds;

            return (days > 0 ? days + "d " : "") + hours + ":" + minutes + ":" + seconds;
        }
    });
</script>